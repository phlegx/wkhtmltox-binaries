#!/usr/bin/env ruby

require 'os'

arch = case RUBY_PLATFORM
  when /64.*linux/
    case `cat /etc/*release`
    when /bionic/
      'bionic-amd64'
    when /buster/
      'buster-amd64'
    when /alpine/
      'alpine-amd64'
    when /CentOS release 8\./
      'centos-x86-64'
    else
      raise 'Linux system cannot be recognized.'
    end
  when /mac|darwin/
    case OS.bits
    when 64
     'cocoa-x86-64'
    else
     raise 'Mac system cannot be recognized.'
    end
  else
    raise 'Invalid platform. Must be a Linux or Mac 64 bit system.'
  end

args = $*.map { |x| x.include?(' ') ? "'" + x + "'" : x }
cmd = File.expand_path "#{File.dirname(__FILE__)}/../libexec/wkhtmltoimage-#{arch}"

exec "#{cmd} #{args.join(' ')}"

